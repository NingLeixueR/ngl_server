cmake_minimum_required(VERSION 3.5)

PROJECT (nglcore)

INCLUDE_DIRECTORIES(./core)
SET(CORE_LIST ${PROJECT_SOURCE_DIR}/core)
FILE(GLOB_RECURSE CORE_LIST_INCLUDE ${CORE_LIST}/*.h ) 
FILE(GLOB_RECURSE CORE_LIST_SRC ${CORE_LIST}/*.cpp) 
FILE(GLOB_RECURSE CORE_LIST_CSRC ${CORE_LIST}/*.c) 
FILE(GLOB_RECURSE CORE_PROTOBUF_LIST_CSRC ${CORE_LIST}/../../../public/*.cc) 
SOURCE_GROUP("Header Files" FILES ${CORE_LIST_INCLUDE})
SOURCE_GROUP("Source Files" FILES ${CORE_LIST_SRC})
SOURCE_GROUP("Source Files" FILES ${CORE_LIST_CSRC})
SOURCE_GROUP("Protobuf Source Files" FILES ${CORE_PROTOBUF_LIST_CSRC})


SET(CMAKE_POSITION_INDEPENDENT_CODE ON)

ADD_DEFINITIONS(-DNGL_EXPORT)

find_package(lua REQUIRED)
find_package(protobuf REQUIRED)
find_package(CURL REQUIRED)
find_package(libmysqlclient REQUIRED)
find_package(hiredis REQUIRED)
find_package(PostgreSQL REQUIRED)

INCLUDE_DIRECTORIES(${lua_INCLUDE_DIRS})   
INCLUDE_DIRECTORIES(${protobuf_INCLUDE_DIRS})  
INCLUDE_DIRECTORIES(${CURL_INCLUDE_DIRS})  
INCLUDE_DIRECTORIES(${libmysqlclient_INCLUDE_DIRS})  
INCLUDE_DIRECTORIES(${hiredis_INCLUDE_DIRS})  
INCLUDE_DIRECTORIES(${PostgreSQL_INCLUDE_DIRS})

ADD_LIBRARY(nglcore SHARED 
	${CORE_LIST_INCLUDE}
	${CORE_LIST_SRC}
	${CORE_LIST_CSRC}
	${CORE_PROTOBUF_LIST_CSRC}
)

# Á´½Ó
target_link_libraries(nglcore PRIVATE lua::lua)
target_link_libraries(nglcore PRIVATE protobuf::protobuf)
target_link_libraries(nglcore PRIVATE CURL::libcurl)
target_link_libraries(nglcore PRIVATE libmysqlclient::libmysqlclient)
target_link_libraries(nglcore PRIVATE hiredis::hiredis)
target_link_libraries(nglcore PRIVATE libpq::libpq)


IF (CMAKE_SYSTEM_NAME MATCHES "Windows")	
	SET(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT")
	SET(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /MT")
	ADD_DEFINITIONS(-DWIN32_LEAN_AND_MEAN)
	SET_TARGET_PROPERTIES(nglcore PROPERTIES COMPILE_FLAGS "/EHa" )
ENDIF (CMAKE_SYSTEM_NAME MATCHES "Windows")





